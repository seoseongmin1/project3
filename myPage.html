<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>경북 길라잡이 : 마이페이지</title>
    <style>
      .body {
        font-family: Arial, sans-serif;
        background-color: #ffffff;
        margin: 0;
        padding: 0;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      .header {
        display: flex;
        align-items: center;
        padding: 10px;
        background-color: #ffffff; /* 원하는 배경색 설정 */
      }
      .logo {
        display: inline-block;
      }

      .search-container {
        display: flex;
        align-items: center; /* 수직 가운데 정렬 */
        justify-content: center; /* 수평 가운데 정렬 */
        background-color: #fff; /* 검색 박스 배경색 */
        border: 1px solid #ccc; /* 검색 박스 테두리 */
        padding: 10px;
        max-width: 700px;
        width: 100%;
        margin-left: 50px;
        border-radius: 10px;
      }
      .buttons {
        display: flex;
        align-items: center;
        margin-left: 120px;
        text-decoration: none;
      }
      .buttons a {
        color: #000000;
      }
      #title {
        border: none;
        padding: 5px;
        flex: 1; /* 나머지 공간을 채우도록 설정 */
      }

      #searchButton {
        background-color: #ffffff; /* 검색 버튼 배경색 */
        color: #fff; /* 검색 버튼 텍스트색 */
        border: none;
        padding: 5px 10px;
        cursor: pointer;
      }

      .search-form {
        display: flex;
        flex: 1; /* 전체 공간을 차지하도록 설정 */
      }
      .custom-button {
        margin-left: 30px; /* 버튼 사이 간격 조정 */
        width: 100px;
        height: 50px;
        border-radius: 10px;
        border: #ffffff;
        background-color: #ffffff;
        text-decoration: none;
        color: #000000;
      }

      .container {
        display: flex;
      }

      .menu {
        width: 360px;
        height: 550px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: #ffffff; /* 배경색 지정 (선택적) */
      }

      .menu li {
        list-style: none;
        margin: 50px 0;
        font-size: large;
      }

      .menu a {
        text-decoration: none;
        color: black; /* 링크 색상 지정 (선택적) */
        padding: 10px; /* 링크간의 간격 조절 (선택적) */
      }

      .info {
        display: flex;
        padding: 50px;
      }

      .changePassword {
        list-style: none;
      }
      .changePassword a {
        color: #7d7d7d;
      }


      .withdraw {
        list-style: none;
      }
      .withdraw a {
        color: #7d7d7d;
      }

      a {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <!-- 자바스크립트로 로그인 확인 -->
    <div class="header">
      <div class="logo">
        <a href="Main.html">
          <img
            src="https://postfiles.pstatic.net/MjAyMzEwMTNfMjYw/MDAxNjk3MTYzNjcwMDYy.XPihVSwY_hfqEmHzfC0ToqtTn8FVtTvsFqmXfFzll94g.qHLCwIalJGLgLIH3TmP6WdFGhIxTDLHeAq0zM2cSbDMg.PNG.dnj1510/%EA%B2%BD%EB%B6%81_%EA%B8%B8%EB%9D%AC%EC%9E%A1%EC%9D%B4.png?type=w580"
            alt="로고"
          />
        </a>
      </div>
      <div class="search-container">
        <form
          id="searchForm"
          name="searchForm"
          method="post"
          onsubmit="submitForm(event)"
          class="search-form"
        >
          <input type="hidden" id="cate_top" />
          <input
            type="text"
            name="title"
            id="title"
            title="검색어 입력"
            placeholder="검색어를 입력하세요"
            class="flex-1"
          />
          <button type="submit" id="searchButton">
            <img
              src="https://postfiles.pstatic.net/MjAyMzExMDVfMjkw/MDAxNjk5MTc2ODE4MjY1.ip9TlhvhZz4ZCGy8tKMO6vKr-3kOG8T-Zy5MBXG6Yogg.zVE42yT4Hf3MUp96DK93HZOmDslaj_YV0W2uJ0Z7QEUg.PNG.dnj1510/search.png?type=w580"
              alt="검색"
            />
          </button>
        </form>
      </div>
      <div class="buttons">
        <button class="custom-button">
          <a href="/wishlist.html">위시리스트</a>
        </button>
        <button class="custom-button">
          <a href="/myPage.html">마이페이지</a>
        </button>
        <button class="custom-button" id="logoutBtn" style="display: none">
            <a href="/logout">로그아웃</a>
          </button>
          <button class="custom-button" id="loginBtn">
            <a href="/login.html">로그인</a>
        <button class="custom-button"><a href="/cs.html">고객센터</a></button>
      </div>
    </div>
    <div class="container">
      <div class="menu">
        <li><a href="MyPage.html">내 프로필</a></li>
        <li><a href="MyPage.html">추가</a></li>
        <li><a href="MyPage.html">정보</a></li>
      </div>
      <div class="info">
        <div class="userinfo">
          <h2>기본정보</h2>
          <p><strong>이름:</strong> <span id="name"></span></p>
          
          <p><strong>생년월일:</strong> <span id="birth"></span></p>
          <p><strong>성별:</strong> <span id="sex"></span></p>
          <p><strong>전화번호:</strong> <span id="phone"></span></p>
          <p><strong>이메일:</strong> <span id="email"></span></p>
          
          <div class="withdraw">
            <li>
              <button id="withdrawButton" onclick="confirmWithdraw()">회원탈퇴</button>
            </li>
            <li>
              <button id="editButton" onclick="enableEdit()">수정</button>
            

            </li>
            <form id="editForm" style="display: none;">
              <!-- 필요한 수정할 수 있는 입력 필드들을 추가합니다 -->
              <label for="editName">이름:</label>
              <input type="text" id="editName" name="editName">
              <label for="editbirth">생년월일:</label>
              <input type="text" id="editbirth" name="editbirth">
              <label for="editName">성별:</label>
              <input type="text" id="editsex" name="editsex">
              <label for="editPhone">전화번호:</label>
              <input type="text" id="editPhone" name="editPhone">
            
              <label for="editEmail">이메일:</label>
              <input type="text" id="editEmail" name="editEmail">
            
              <!-- 수정 사항을 서버로 보내는 버튼을 추가합니다 -->
              <button type="button" onclick="submitEditForm()">저장</button>
            </form>

             
          
            
          
        </div>
      
  
    <script>
      var currentSlide = 0; // 현재 슬라이드 인덱스

      function confirmWithdraw() {
    const confirmed = confirm("정말 회원탈퇴 하시겠습니까?");
    
    if (confirmed) {
      withdrawUser();
    }
  }

  function withdrawUser() {
    fetch("/withdraw", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    })
    .then((response) => response.json())
    .then((data) => {
      // 서버로부터 받은 응답 처리
      if (data.success) {
        alert("회원탈퇴가 완료되었습니다.");
        // 로그아웃 처리 또는 다른 페이지로 이동 등을 수행할 수 있습니다.
        window.location.href = "/logout";
      } else {
        alert("회원탈퇴 중 오류가 발생했습니다.");
      }
    })
    .catch((error) => {
      console.error("Error withdrawing user:", error);
    });
  }

  function displayUserInfo(userInfo) {
    document.getElementById("name").textContent = userInfo.name;
    document.getElementById("birth").textContent = userInfo.birth;
    document.getElementById("sex").textContent = userInfo.sex;
    document.getElementById("phone").textContent = userInfo.phone;
    document.getElementById("email").textContent = userInfo.email;
    
    // 패스워드는 보안상 표시하지 않는 것이 좋습니다.
  }
      
      // 검색 폼 제출 시
document.getElementById("searchForm").addEventListener("submit", function (event) {
    event.preventDefault();

    // 검색어 가져오기
    const searchKeyword = document.getElementById("title").value;

    // 입력이 없을 경우 경고 메시지 표시
    if (!searchKeyword.trim()) {
        alert("검색어를 입력하세요.");
        return;
    }

    // 검색 요청 보내기
    fetch("/search.do", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({ title: searchKeyword }),
    })
    .then((response) => response.json())
    .then((data) => {
        // 검색 결과를 받아와서 동적으로 UI에 추가
        // 여기서는 결과를 search-result.html로 이동하는 방식으로 변경
        window.location.href = `/search-result.html?results=${encodeURIComponent(JSON.stringify(data))}`;
    })
    .catch((error) => {
        console.error("Error searching:", error);
    });
});

      function checkLoginStatus() {
        fetch("/currentUser")
          .then((response) => response.json())
          .then((data) => {
            const user = data.username;

            // 여기에서 user 상태에 따라 버튼을 표시/숨김 처리
            if (user) {
              document.getElementById("logoutBtn").style.display = "block";
              document.getElementById("loginBtn").style.display = "none";
              
              // 유저 정보 가져오기
            fetch("/getUserInfo")
            .then((response) => response.json())
            .then((userInfo) => {
              // 가져온 정보를 표시
              displayUserInfo(userInfo);
            })
            .catch((error) => {
              console.error("Error getting user info:", error);
            });
           
            } else {
              document.getElementById("logoutBtn").style.display = "none";
              document.getElementById("loginBtn").style.display = "block";
            }
          })
          .catch((error) => {
            console.error("Error checking login status:", error);
          });
      }
      function toggleEditFields() {
    const editFields = document.getElementById('editFields');
    editFields.style.display = (editFields.style.display === 'none' || editFields.style.display === '') ? 'block' : 'none';
  }

  function enableEdit() {
  document.getElementById("editButton").style.display = "none";
  document.getElementById("editForm").style.display = "block";

  // 현재 정보를 수정 양식에 표시합니다
  document.getElementById("editName").value = document.getElementById("name").textContent;
  document.getElementById("editbirth").value = document.getElementById("birth").textContent;
  document.getElementById("editsex").value = document.getElementById("sex").textContent;
  document.getElementById("editPhone").value = document.getElementById("phone").textContent;
  document.getElementById("editEmail").value = document.getElementById("email").textContent;
}

// 수정 양식 제출을 처리하는 함수를 추가합니다
function submitEditForm() {
  const updatedInfo = {
    name: document.getElementById("editName").value,
    birth: document.getElementById("editbirth").value,
    phone: document.getElementById("editPhone").value,
    sex: document.getElementById("editsex").value,
    email: document.getElementById("editEmail").value,
  };

  // 서버에 수정된 정보를 보냅니다
  fetch("/updateUserInfo", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(updatedInfo),
  })
  .then((response) => response.json())
  .then((data) => {
    if (data.success) {
      alert("정보가 성공적으로 업데이트되었습니다.");
      
      // 저장 성공 후 최신 정보를 서버에서 다시 가져옴
      fetchUserInfo();
    } else {
      alert("정보 업데이트 중 오류가 발생했습니다.");
    }
  })
  .catch((error) => {
    console.error("Error updating user info:", error);
  });
}
function fetchUserInfo() {
  // 최신 정보를 서버에서 가져와서 화면에 반영
  fetch("/getUserInfo")
  .then((response) => response.json())
  .then((userInfo) => {
    // 가져온 정보를 표시
    displayUserInfo(userInfo);
  })
  .catch((error) => {
    console.error("Error getting user info:", error);
  });
}

      
      

      // 페이지 로드 시 사용자 로그인 상태 확인
      window.onload = checkLoginStatus;
    </script>
  </body>
</html>
